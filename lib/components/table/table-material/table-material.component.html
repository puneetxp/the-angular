  <div>
    @if (isfilter) {
      <mat-form-field class="w-full mt-2">
        <mat-label>Filter</mat-label>
        <input matInput [(ngModel)]="dataSource.filter" (keyup)="MatTable()" placeholder="Ex. ium" #input class="w-full">
      </mat-form-field>
    }
    <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows
      class="mat-elevation-z2 w-full overflow-scroll">
      
      @if (photoResolver) {
        <ng-container matColumnDef="photo_id">
          <th mat-header-cell *matHeaderCellDef> Photo </th>
          <td mat-cell *matCellDef="let element">
            <img class="h-10 w-10 p-1 pb-0" [src]="domain + ((photoResolver!(element.photo_id) | async)?.public || '')" />
          </td>
        </ng-container>
      }
      
      <!-- Generic Columns Logic: Loop over columnsToDisplayfilter which excludes photo_id -->
      @for (column of columnsToDisplayfilter; track column) {
        <ng-container matColumnDef="{{column}}">
          <th mat-header-cell *matHeaderCellDef class="capitalize" mat-sort-header> {{column}} </th>
          <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
        </ng-container>
      }

      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
        <td mat-cell *matCellDef="let element">
          @if (isEdit) {
            <button mat-icon-button (click)="edit.emit(element)">
              <mat-icon color="accent">edit</mat-icon>
            </button>
          }
          @if (isDelete) {
            <button mat-icon-button (click)="delete.emit(element)">
              <mat-icon color="warn">delete_forever</mat-icon>
            </button>
          }
          @if (isexpandSwitch) {
            <button mat-icon-button aria-label="expand row" (click)="(elementselected === element ? select(null) : select(element));
            $event.stopPropagation()">
              @if (elementselected !== element) {
                <mat-icon>keyboard_arrow_down</mat-icon>
              }
              @if (elementselected === element) {
                <mat-icon>keyboard_arrow_up</mat-icon>
              }
            </button>
          }
        </td>
      </ng-container>

      <!-- Expanded Content Column -->
      <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
          <div class="flex overflow-hidden" [ngClass]="element === elementselected ? 'w-full' : 'w-0'"
            [@detailExpand]="element === elementselected ? 'expanded' : 'collapsed'">
            @if (element === elementselected) {
              <ng-template [cdkPortalOutlet]="templatePortal">
              </ng-template>
            }
          </div>
        </td>
      </ng-container>
      
      @if (isEdit || isDelete || buttons.length) {
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="w-24 text-center">Actions</th>
          <td mat-cell *matCellDef="let row" class="flex space-x-1">
            @if (isEdit) {
              <button mat-icon-button (click)="edit.emit(row); $event.stopPropagation()">
                <mat-icon color="accent">edit</mat-icon>
              </button>
            }
            @if (isDelete) {
              <button mat-icon-button (click)="delete.emit(row); $event.stopPropagation()">
                <mat-icon color="warn">delete_forever</mat-icon>
              </button>
            }
            @for (button of buttons; track button) {
              <button mat-icon-button (click)="button.callBack(row); $event.stopPropagation()">
                <mat-icon>{{ button.icon }}</mat-icon>
              </button>
            }
          </td>
        </ng-container>
      }

      @if (isexpand) {
        <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
        <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;" class="example-element-row"
          [class.example-expanded-row]="elementselected === element"
          (click)="(elementselected === element ? select(null) : select(element))">
        </tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      } @else {
        <tr mat-header-row *matHeaderRowDef="columnsForList"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsForList;" (click)="select(row)"></tr>
      }
      
      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No data matching the filter "{{dataSource.filter}}"</td>
      </tr>
    </table>
    @if (dataSource.data.length > 10 && isPaginate) {
      <mat-paginator [pageSize]="PageSize"
        [pageSizeOptions]="[5,10,25,50,100]" aria-label="Paginator"></mat-paginator>
    }
  </div>
<ng-template #templatePortalContent>
  <ng-content />
</ng-template>
