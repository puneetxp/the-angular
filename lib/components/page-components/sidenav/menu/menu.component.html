<div class="sticky top-0 h-full bg-white/95 border-r border-slate-200/70 shadow-[inset_-1px_0_0_rgba(15,23,42,0.08)]">
  @if (params | async) {
    <div class="h-[calc(100vh-112px)] overflow-y-auto px-3 py-4 space-y-5 lg:h-[calc(100vh-112px)]">
      <div class="flex flex-col gap-5">
        @for (group of groupedMenus; track group.group ?? 'default') {
          <section class="flex flex-col gap-2">
            @if (group.group) {
              <p class="px-3 text-[11px] font-semibold tracking-[0.2em] text-slate-400 uppercase">
                {{ group.group }}
              </p>
            }
            <div class="flex flex-col gap-1.5">
              @for (menu of group.menus; track menu.route ?? menu.name) {
                <!-- Menu Item Row -->
                <div class="group flex items-center w-full min-h-[44px] rounded-full transition-all duration-200 overflow-hidden cursor-pointer select-none"
                  [ngClass]="{
                    'bg-primary/10 text-primary ring-1 ring-primary/15 shadow-sm': ActiveRoute(menu),
                    'hover:bg-slate-100 text-slate-700': !ActiveRoute(menu)
                  }">
                  
                  <!-- Link Region (Flex-1) -->
                  <a
                    class="flex-1 flex items-center gap-3 px-4 py-2.5 text-left no-underline outline-none text-inherit transition-colors"
                    [routerLink]="menu.route"
                    routerLinkActive="active"
                    [routerLinkActiveOptions]="{ exact: true }"
                    [class.text-primary]="ActiveRoute(menu)"
                    [class.font-semibold]="ActiveRoute(menu)"
                  >
                    @if (menu.icon) {
                      <mat-icon class="text-[20px] leading-5" [fontIcon]="menu.icon"></mat-icon>
                    }
                    <div class="flex flex-col leading-tight">
                      <span class="font-medium text-[14px]">{{ menu.name }}</span>
                      @if (menu.label) {
                        <small class="text-[10px] opacity-70">{{ menu.label }}</small>
                      }
                    </div>
                  </a>

                  <!-- Toggle/Badge Region (Flex-none) -->
                  <!-- @if (menu.child?.length) {
                    <div class="flex items-center gap-1 pr-2">
                      <span
                        class="inline-flex items-center justify-center rounded-full bg-black/5 text-[10px] font-medium px-2 h-5 min-w-[20px]"
                        [ngClass]="{ 'bg-primary/20 text-primary': ActiveRoute(menu) }">
                        {{ menu.child?.length ?? 0 }}
                      </span>
                      <button mat-icon-button type="button" 
                              class="!w-8 !h-8 flex items-center justify-center rounded-full hover:bg-black/5 transition-colors text-inherit"
                              (click)="toggleExpansion(menu, $event)">
                        <mat-icon class="!w-5 !h-5 !text-[20px] leading-5">{{ isExpanded(menu) ? 'expand_less' : 'expand_more' }}</mat-icon>
                      </button>
                    </div>
                  } -->
                </div>

                @if (hasEditingChild(menu)) {
                  <div class="px-4 pb-1 text-[10px] uppercase tracking-wider font-semibold text-primary/70">
                    Editing {{ editingContext }}
                  </div>
                }

                @if (menu.child && ActiveRoute(menu)) {
                  <div class="flex flex-col gap-1 mt-1 pl-4">
                    @for (child of menu.child; track child.route ?? child.name) {
                      @if (ActiveRoute(child)) {
                        <a
                          class="flex items-center gap-3 rounded-full px-4 py-2 text-[13px] transition-colors no-underline min-h-[40px]"
                          [ngClass]="{
                            'bg-primary/5 text-primary font-semibold ring-1 ring-primary/20 shadow-sm': ActiveRoute(child),
                            'text-slate-600 hover:bg-slate-50 hover:text-slate-900': !ActiveRoute(child)
                          }"
                          routerLinkActive="active"
                          [routerLinkActiveOptions]="{ exact: false }"
                          [routerLink]="child.route"
                        >
                          <mat-icon class="text-[18px] leading-[18px] opacity-70" fontIcon="subdirectory_arrow_right"></mat-icon>
                          <span class="flex-1">{{ child.name }}</span>
                          
                          @if (child.name && child.name.toLowerCase().includes('edit')) {
                            <span
                              class="inline-flex items-center gap-1 rounded-full bg-black/5 px-2 py-0.5 text-[10px]"
                              [ngClass]="{
                                'bg-primary/10 text-primary': ActiveRoute(child),
                                'bg-black/5 text-slate-500': !ActiveRoute(child)
                              }">
                              <mat-icon class="!text-[12px] !w-3 !h-3 leading-3" fontIcon="edit"></mat-icon>
                              <span>{{ isEditingChild(child) ? (editingContext || 'Editing') : 'Editing' }}</span>
                            </span>
                          }
                        </a>
                      }
                    }
                  </div>
                }
              }
            </div>
          </section>
        }
      </div>
    </div>
  }
</div>
